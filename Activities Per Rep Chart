
###ACTIVITIES PER REP###

with calls as (
  select
  (
    u.first_name || ' ' || u.last_name
  )
  as Rep_Name
  , count(t.created_date) as Calls_Made
from
  salesforce_fivetran.user u
  join salesforce_fivetran.task t on
    t.owner_id = u.id
where
  t.created_date > '2020-04-01'
  and u.title = 'Account Executive'
  and (t.type = 'Call' or t.subject like '[%call%]' or t.subject like '[%Call]')
group by
  Name,u.first_name,u.last_name
  )


select
  (
    u.first_name || ' ' || u.last_name
  )
  as Name
  , count(t.created_date) as Total_Activities
  , calls.Calls_Made
  ,case when (Total_Activities >= 500 and Calls_Made >= 150) then 'Spiff Qualified' else 'Not Qualified' end as Spiff_Qualified
from
  salesforce_fivetran.user u
  join salesforce_fivetran.task t on
    t.owner_id = u.id
  left join calls on calls.Rep_Name = Name
where
  t.created_date > '2020-04-01'
  and u.title = 'Account Executive'
  and t.status = 'Completed'
  and (t.subject like '%[Out]%' or t.subject like '%[outbound]%' or t.subject like '%LINKEDIN MESSAGE%')
group by
  Name,u.first_name,u.last_name,Calls_Made
